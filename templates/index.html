<!DOCTYPE html>
<html>

<head>
    <title>UF App</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=1">
    <link rel="stylesheet" type="text/css" href="/css/schema.min.css">
</head>

<body>
    <div class="container">
        <div class="row-fluid">
            <h1>My App</h1>
        </div>
        <div class="row-fluid">
            <div id="loading-indicator" class="alert a-is-info">
                <p>
                    <strong>Loading...</strong>
                </p>
            </div>
        </div>
        <div id="response-container" class="row-fluid">
            <h4>Response body</h4>
            <textarea class="form-element" rows="4"></textarea>
        </div>
    </div>
    <script type="text/javascript" src="/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/js/global.js"></script>
    <script type="text/javascript" src="/js/kido-js.js"></script>
    <script type="text/javascript">
    /* jshint browser: true, node: false */
    /* global $, Kido */
    $(function() {
        'use strict';
        var kido,
            $loading_indicator = $('#loading-indicator'),
            $response_container = $('#response-container');

        function onResponse(res) {
            $response_container.find('textarea').val(JSON.stringify(res, 0, 2));
        }

        function onRequestError(err) {
            window.alert('There was an error executing your request\n' + JSON.stringify(err));
        }

        $(document)
            .ajaxStart(function() {
                $loading_indicator.show();
                $response_container.hide();
            })
            .ajaxComplete(function() {
                $loading_indicator.hide();
                $response_container.show();
            });

        $.ajax({
                type: 'GET',
                url: '/token'
            })
            .done(function(token) {
                kido = new Kido('tasks', 'contoso.local.kidozen.com', {
                    token: token
                });
                kido
                    .storage()
                    .objectSet('tasks')
                    .query()
                    .done(onResponse)
                    .fail(onRequestError);
            })
            .fail(onRequestError);
    });
    </script>
</body>

</html>
